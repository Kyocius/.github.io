<!DOCTYPE html>
<html><head>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400..700;1,400..700&family=Noto+Serif+SC&family=Ubuntu+Mono:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">
<title>笨方法学 C 附加题不完全解答</title>




<meta charset="utf-8">
<meta name="X-UA-Compatible" content="IE=edge">
<meta name="google-site-verification" content="">
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
<meta content="telephone=no" name="format-detection">
<meta name="description" content="Partial Answers for Learn C The Hard Way">
<meta name="renderer" content="webkit">
<meta name="theme-color" content="#ffffff">



<meta property="og:title" content="笨方法学 C 附加题不完全解答" />
<meta property="og:description" content="Partial Answers for Learn C The Hard Way" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://kyocius.github.io/posts/ysyx/clang-review/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-23T00:00:00+00:00" />
<meta property="article:modified_time" content="2024-01-23T00:00:00+00:00" /><meta property="og:site_name" content="My Blog" />






<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="笨方法学 C 附加题不完全解答"/>
<meta name="twitter:description" content="Partial Answers for Learn C The Hard Way"/>









<script type="text/javascript">
  (function(c,l,a,r,i,t,y){
      c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
      t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
      y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
  })(window, document, "clarity", "script", "abcdefghzd");
</script>



  






      <script src="/js/toc.js"></script>
    
    <link type="text/css" rel="stylesheet" href="/vendor/css/bootstrap.min.css">

<link rel="stylesheet" href="/scss/dark-mode.min.b60ebb44f6836508f5181ee036582b442efa24bbd7d5e42d547e04e68bd25d01.css" integrity="sha256-tg67RPaDZQj1GB7gNlgrRC76JLvX1eQtVH4E5ovSXQE=" media="screen">


<link rel="stylesheet"
          href="https://fonts.googleapis.com/css?family=Material+Icons">



















</head>
<body>
    	<div id="app"><div class="single-column-drawer-container" id="drawer"
     v-bind:class="{ 'single-column-drawer-container-active': isDrawerOpen }">
    <div class="drawer-content">
        <div class="drawer-menu">
            
            
            
                
                
                
                    
                
                
                
                <a class="a-block drawer-menu-item active" href="/posts">
                    歸檔 Archive
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/categories">
                    分類 Categories
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/tags">
                    標簽 Tags
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/about/">
                    關於 About
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/index.xml">
                    訂閱 RSS
                </a>
                
            
            
            <div class="toc">


	<div class="toc-content">
	
		
		
		
		<center>- 目錄 -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e5%89%8d%e8%a8%80" class="nav-前言">
									前言
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e7%bb%83%e4%b9%a010%e5%ad%97%e7%ac%a6%e4%b8%b2%e6%95%b0%e7%bb%84%e5%92%8c%e5%be%aa%e7%8e%af" class="nav-练习10字符串数组和循环">
									练习10：字符串数组和循环
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e7%bb%83%e4%b9%a016%e7%bb%93%e6%9e%84%e4%bd%93%e5%92%8c%e6%8c%87%e5%90%91%e5%ae%83%e4%bb%ac%e7%9a%84%e6%8c%87%e9%92%88" class="nav-练习16结构体和指向它们的指针">
									练习16：结构体和指向它们的指针
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e7%bb%83%e4%b9%a017%e5%a0%86%e5%92%8c%e6%a0%88%e7%9a%84%e5%86%85%e5%ad%98%e5%88%86%e9%85%8d" class="nav-练习17堆和栈的内存分配">
									练习17：堆和栈的内存分配
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e7%bb%83%e4%b9%a018%e5%87%bd%e6%95%b0%e6%8c%87%e9%92%88" class="nav-练习18函数指针">
									练习18：函数指针
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e7%bb%83%e4%b9%a032%e5%8f%8c%e5%90%91%e9%93%be%e8%a1%a8" class="nav-练习32双向链表">
									练习32：双向链表
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
            
        </div>
    </div>
</div>
<transition name="fade">
    <div id="drawer-mask" v-bind:class="{ 'single-column-drawer-mask': mounted }" v-if="isDrawerOpen" v-on:click="toggleDrawer"></div>
</transition>
<nav id="navBar" class="navbar sticky-top navbar-light single-column-nav-container">
    <div id="navBackground" class="nav-background"></div>
    <div class="container container-narrow nav-content">
        <button id="nav_dropdown_btn" class="nav-dropdown-toggle" type="button" v-on:click="toggleDrawer">
            <i class="material-icons">
                menu
            </i>
        </button>
        <a id="navTitle" class="navbar-brand" href="https://kyocius.github.io/">
            游尔曼斯克
        </a>
        
        <button type="button" class="nav-darkmode-toggle" id="darkModeToggleButton2">
            <i class="material-icons" id="darkModeToggleIcon2">
                dark_mode
            </i>
        </button>
        
    </div>
</nav>
<div class="single-column-header-container" id="pageHead"
     v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }">
    <a href="https://kyocius.github.io/">
        <div class="single-column-header-title">游尔曼斯克</div>
        
        <div class="single-column-header-subtitle">Kyocius &#43;</div>
        

    </a>
</div>

            <div id="content">
                <div id="streamContainer" class="stream-container">

    <div class="post-list-container post-list-container-shadow">
        <div class="post">
            
            
            

            <div class="post-head-wrapper-text-only"
                
            >
                <div class="post-title">
                    笨方法学 C 附加题不完全解答
                    
                    <div class="post-subtitle">
                        Partial Answers for Learn C The Hard Way
                    </div>
                    
                    <div class="post-meta">
                        
                        <time itemprop="datePublished">
                            2024-01-23 00:00
                        </time>
                        

                        
                            <i class="material-icons" style="">folder</i>
                                <a href="/categories/">[编程]</a>
                                &nbsp;
                        

                        
                            <i class="material-icons" style="">label</i>
                            
                                <a href="/tags/clang">Clang</a>
                                &nbsp;
                            
                                <a href="/tags/ysyx">ysyx</a>
                                &nbsp;
                            
                        
                        
                    </div>
                </div>
            </div>
            
            <div class="post-body-wrapper">
                
                <div class="post-body" v-pre>
                
                    <h2 id="前言">前言</h2>
<p>笔者撰写本文时还在上大一，数据结构基础几乎为零，所以会有一些可笑的问题和不合时宜的吐槽。</p>
<p>本文尝试解答书后附加题，有的章节太简单就略过了。</p>
<h2 id="练习10字符串数组和循环">练习10：字符串数组和循环</h2>
<ol>
<li>如何使用 <code>,</code>（逗号）字符来在for循环的每一部分中，<code>;</code>（分号）之间分隔多条语句？</li>
</ol>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#fff;font-weight:bold">for</span> (i = <span style="color:#ff0;font-weight:bold">0</span>, j = <span style="color:#ff0;font-weight:bold">10</span>; i &lt; <span style="color:#ff0;font-weight:bold">10</span>; i++, j--)
</code></pre></div><ol start="2">
<li>查询 <code>NULL</code> 是什么东西，看看它会打印出什么？</li>
</ol>
<p>在 C 语言中，NULL 是一个宏定义，通常用于表示指针不指向任何有效的对象或地址。NULL 的确切定义可能因编译器和平台而异，但通常它被定义为 <code>(void *)0</code>，即一个转换为 <code>void</code> 指针类型的零值。</p>
<p>当你尝试打印一个指向 <code>NULL</code>的指针时，结果会取决于你是如何打印它的。在 C 语言中，如果你使用 <code>%p</code> 格式化标志（用于打印指针地址）和 <code>printf</code> 函数，通常会打印出一个表示空指针的值，通常是 <code>(nil)</code> 或者 <code>0x0</code>，具体取决于编译器和平台。</p>
<ol start="3">
<li>看看你是否能在打印之前将 <code>states</code> 的一个元素赋值给 <code>argv</code> 中的元素，再试试相反的操作？</li>
</ol>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;stdio.h&gt;</span><span style="color:#0f0;font-weight:bold">
</span><span style="color:#0f0;font-weight:bold"></span>
<span style="color:#fff;font-weight:bold">int</span> main(<span style="color:#fff;font-weight:bold">int</span> argc, <span style="color:#fff;font-weight:bold">char</span> *argv[]) {
  
  
    <span style="color:#fff;font-weight:bold">char</span> *states[] = {<span style="color:#0ff;font-weight:bold">&#34;California&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Oregon&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Washington&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Texas&#34;</span>};

    <span style="color:#007f7f">// 将states的一个元素赋值给argv的一个元素
</span><span style="color:#007f7f"></span>    <span style="color:#007f7f">// 注意：这通常不是个好主意，因为argv通常不应被修改
</span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">if</span> (argc &gt; <span style="color:#ff0;font-weight:bold">1</span>) {
        argv[<span style="color:#ff0;font-weight:bold">1</span>] = states[<span style="color:#ff0;font-weight:bold">0</span>];
        printf(<span style="color:#0ff;font-weight:bold">&#34;argv[1] is now %s</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>, argv[<span style="color:#ff0;font-weight:bold">1</span>]);
    }

    <span style="color:#007f7f">// 将argv的一个元素赋值给states的一个元素
</span><span style="color:#007f7f"></span>    states[<span style="color:#ff0;font-weight:bold">0</span>] = argv[<span style="color:#ff0;font-weight:bold">0</span>];
    printf(<span style="color:#0ff;font-weight:bold">&#34;states[0] is now %s</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>, states[<span style="color:#ff0;font-weight:bold">0</span>]);

    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#ff0;font-weight:bold">0</span>;
}
</code></pre></div><h2 id="练习16结构体和指向它们的指针">练习16：结构体和指向它们的指针</h2>
<ol>
<li>如何在栈上创建结构体，就像你创建任何其它变量那样？</li>
<li>如何使用 <code>x.y</code> 而不是 <code>x-&gt;y</code> 来初始化结构体？</li>
</ol>
<p>对于前两个问题其实非常好解答。只要把变量 <code>x</code> 设置成非指针即可。</p>
<ol start="3">
<li>如何不使用指针来将结构体传给其它函数？</li>
</ol>
<p>C 语言<strong>不可能</strong>不使用指针传递结构体本身。所以这道题的意思就浅显地指，把参数的 <code>*</code> 去掉你会不会&hellip;</p>
<p>详细代码请见：<a href="https://github.com/eleloya23/Learn-C-The-Hard-Way/blob/master/Ex16/ex16_e.c">GitHub</a></p>
<h2 id="练习17堆和栈的内存分配">练习17：堆和栈的内存分配</h2>
<blockquote>
<p>对于现在你们这些年轻人来说，编程简直太容易了。如果你玩玩 Ruby 或者 Python 的话，只要创建对象或变量就好了，不用管它们存放在哪里。</p>
</blockquote>
<p>理清内存最简单原则：如果你的变量并不是从 <code>malloc</code> 中获取的，也不是从一个从 <code>malloc</code> 获取的函数中获取的，那么它在栈上。</p>
<ol>
<li><code>strncpy</code> 有什么设计缺陷？</li>
</ol>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#fff;font-weight:bold">char</span> *strncpy(<span style="color:#fff;font-weight:bold">char</span> *dest, <span style="color:#fff;font-weight:bold">const</span> <span style="color:#fff;font-weight:bold">char</span> *src, size_t n)
</code></pre></div><p><code>strcpy</code> 函数不会向 <code>dest</code> 追加 <code>\0</code>，也就是字符串没有了结束，可能会造成内存非法访问。</p>
<ol start="2">
<li>C 如何打包结构体？结构体添加一些字段之后的新大小？</li>
</ol>
<p>在 C 语言中，结构体的默认对齐方式通常是按照结构体成员中占用内存最大的数据类型进行对齐。这被称为“最大成员对齐”或“自然对齐”。</p>
<p>结构体的总大小是其最大对齐成员的大小的整数倍。</p>
<h2 id="练习18函数指针">练习18：函数指针</h2>
<p>函数指针编写窍门：</p>
<ul>
<li>编写一个普通的函数声明：<code>int callme(int a, int b)</code></li>
<li>将函数用指针语法包装：<code>int (*callme)(int a, int b)</code></li>
<li>将名称改成指针名称：<code>int (*compare_cb)(int a, int b)</code></li>
</ul>
<p>我们可以使用 <code>typedef</code> 来简化函数指针以便于传参：</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#fff;font-weight:bold">typedef</span> <span style="color:#fff;font-weight:bold">int</span> (*compare_cb)(<span style="color:#fff;font-weight:bold">int</span> a, <span style="color:#fff;font-weight:bold">int</span> b)
</code></pre></div><p>如此，在另一个函数中，我们就能将 <code>compare_cb</code> 作为类型传递：</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#fff;font-weight:bold">int</span> *bubble_sort(<span style="color:#fff;font-weight:bold">int</span> *numbers, <span style="color:#fff;font-weight:bold">int</span> count, compare_cb cmp)
</code></pre></div><ol>
<li>将错误的函数传给 <code>compare_cb</code>，并看看 C 编辑器会报告什么错误？</li>
</ol>
<p>类似于 &ldquo;assignment from incompatible pointer type&rdquo; 或 &ldquo;incompatible types in assignment&rdquo; 的错误消息。</p>
<ol start="2">
<li>将 <code>NULL</code> 传给它，看看程序中会发生什么。然后运行 Valgrind 来看看它会报告什么？</li>
</ol>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;stdio.h&gt;</span><span style="color:#0f0;font-weight:bold">
</span><span style="color:#0f0;font-weight:bold"></span>
<span style="color:#fff;font-weight:bold">void</span> myFunction(<span style="color:#fff;font-weight:bold">int</span> *ptr) {
    <span style="color:#fff;font-weight:bold">if</span> (ptr != <span style="color:#fff;font-weight:bold">NULL</span>) {
        <span style="color:#007f7f">// 在这里解引用非空指针
</span><span style="color:#007f7f"></span>        *ptr = <span style="color:#ff0;font-weight:bold">42</span>;
    }
}

<span style="color:#fff;font-weight:bold">int</span> main() {
    <span style="color:#fff;font-weight:bold">int</span> *nullPointer = <span style="color:#fff;font-weight:bold">NULL</span>;

    <span style="color:#007f7f">// 将 NULL 传递给函数指针
</span><span style="color:#007f7f"></span>    myFunction(nullPointer);

    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#ff0;font-weight:bold">0</span>;
}
</code></pre></div><p>Valgrind 的报错：</p>
<pre><code>==12345== Invalid write of size 4
==12345==    at 0x80484A7: myFunction (example.c:6)
==12345==    by 0x80484F4: main (example.c:14)
==12345==  Address 0x0 is not stack'd, malloc'd or (recently) free'd
</code></pre><p>这个报告表明在 <code>myFunction</code> 函数的第 6 行发生了一个尝试写入大小为 4 的无效内存。</p>
<h2 id="练习32双向链表">练习32：双向链表</h2>
<p>强烈建议 0 数据结构基础先去油管看一下印度老哥的双向链表教程：<a href="https://www.youtube.com/watch?v=nsMWbs-r4vE&amp;list=PLBlnK6fEyqRg7pacSDMgPn7vDVhz3N1uf&amp;index=2">YouTube</a></p>
<p>先在头文件中编写两个结构体：</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;stdlib.h&gt;</span><span style="color:#0f0;font-weight:bold">
</span><span style="color:#0f0;font-weight:bold"></span>
<span style="color:#fff;font-weight:bold">struct</span> ListNode;

<span style="color:#fff;font-weight:bold">typedef</span> <span style="color:#fff;font-weight:bold">struct</span> ListNode
{
    <span style="color:#fff;font-weight:bold">struct</span> ListNode *prev;
    <span style="color:#fff;font-weight:bold">struct</span> ListNode *next;
    <span style="color:#fff;font-weight:bold">void</span> *value; <span style="color:#007f7f">// 可以指向任何数据类型
</span><span style="color:#007f7f"></span>} ListNode;

<span style="color:#fff;font-weight:bold">typedef</span> <span style="color:#fff;font-weight:bold">struct</span> List
{
    ListNode *first;
    ListNode *last;
    <span style="color:#fff;font-weight:bold">int</span> count;
}
</code></pre></div><p>然后预定义四个 List 的整体方法：</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c">List *List_create();
<span style="color:#fff;font-weight:bold">void</span> List_destroy(List *list);
<span style="color:#fff;font-weight:bold">void</span> List_clear(List *list);
<span style="color:#fff;font-weight:bold">void</span> List_clear_destroy(List *list);
</code></pre></div><p>三个宏方法（不知道为什么要用宏）：</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#0f0;font-weight:bold">#define List_count(A) ((A)-&gt;count)
</span><span style="color:#0f0;font-weight:bold"></span>
<span style="color:#0f0;font-weight:bold">#define List_first(A) ((A)-&gt;first != NULL ? (A)-&gt;first-&gt;value : NULL)
</span><span style="color:#0f0;font-weight:bold"></span>
<span style="color:#0f0;font-weight:bold">#define List_last(A) ((A)-&gt;last != NULL ? (A)-&gt;last-&gt;value : NULL)
</span></code></pre></div><p>接下来预定义数据的操作方法：</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#fff;font-weight:bold">void</span> List_push(List *list, <span style="color:#fff;font-weight:bold">void</span> *value);
<span style="color:#fff;font-weight:bold">void</span> *List_pop(List *list);

<span style="color:#007f7f">// 链表的头部插入与删除，命名风格来自于 Perl 语言
</span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">void</span> List_unshift(List *list, <span style="color:#fff;font-weight:bold">void</span> *value);
<span style="color:#fff;font-weight:bold">void</span> *List_shift(List *list);

<span style="color:#fff;font-weight:bold">void</span> *List_remove(List *list, ListNode *node);
</code></pre></div><p>定义 <code>LIST_FOREACH</code> 宏。书中说这是个常见的习语：</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#0f0;font-weight:bold">#define LIST_FOREACH(L, S, M, V) ListNode *_node = NULL; \
</span><span style="color:#0f0;font-weight:bold">    ListNode *V = NULL;\
</span><span style="color:#0f0;font-weight:bold">    for(V = _node = L -&gt; S; _node != NULL; V = _node = _node -&gt; M)
</span></code></pre></div><p>这个宏利用了一个 <code>for</code> 循环，其中 <code>_node</code> 用于跟踪当前节点，<code>V</code> 用于表示当前节点。在每次迭代中，<code>_node</code> 被更新为下一个节点，从而实现链表遍历的封装。</p>
<p>现在开始实现头文件的方法。在 <code>list.c</code> 中先完成 List 的整体方法：</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;lcthw/list.h&gt;</span><span style="color:#0f0;font-weight:bold">
</span><span style="color:#0f0;font-weight:bold"></span>
List *List_create()
{
    <span style="color:#fff;font-weight:bold">return</span> calloc(<span style="color:#ff0;font-weight:bold">1</span>, <span style="color:#fff;font-weight:bold">sizeof</span>(List));
}

<span style="color:#fff;font-weight:bold">void</span> List_destroy(List *list)
{
    LIST_FOREACH(list, first, next, cur)
    {
        <span style="color:#fff;font-weight:bold">if</span> (cur-&gt;prev)
            free(cur-&gt;prev)
    }
    free(list-&gt;last);
    free(list);
}

<span style="color:#fff;font-weight:bold">void</span> List_clear(List *list)
{
    LIST_FOREACH(list, first, next, cur) 
    {
        free(cur-&gt;value);
    }
}

<span style="color:#fff;font-weight:bold">void</span> List_clear_destroy(List *list)
{
    List_clear(list);
    List_destroy(list);
}
</code></pre></div><p>接下来实现数据的操作方法：</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#fff;font-weight:bold">void</span> List_push(List *list, <span style="color:#fff;font-weight:bold">void</span> *value)
{
    ListNode *node = calloc(<span style="color:#ff0;font-weight:bold">1</span>, <span style="color:#fff;font-weight:bold">sizeof</span>(ListNode));
    check_mem(node); <span style="color:#007f7f">// 跳转到 error 标签
</span><span style="color:#007f7f"></span>
    node-&gt;value = value;

    <span style="color:#fff;font-weight:bold">if</span>(list-&gt;last == <span style="color:#fff;font-weight:bold">NULL</span>)
    {
        list-&gt;first = node;
        list-&gt;last = node;
    }
    <span style="color:#fff;font-weight:bold">else</span>
    {
        list-&gt;last-&gt;next = node;
        node-&gt;prev = list-&gt;last;
        list-&gt;last = node;
    }
    list-&gt;count++;
error:
    <span style="color:#fff;font-weight:bold">return</span>;
}

<span style="color:#fff;font-weight:bold">void</span> *List_pop(List *list)
{
    ListNode *node = list-&gt;last;
    <span style="color:#fff;font-weight:bold">return</span> node != <span style="color:#fff;font-weight:bold">NULL</span> ? List_remove(list, node) : <span style="color:#fff;font-weight:bold">NULL</span>;
}

<span style="color:#fff;font-weight:bold">void</span> List_unshift(List *list, <span style="color:#fff;font-weight:bold">void</span> *value)
{
    ListNode *node = calloc(<span style="color:#ff0;font-weight:bold">1</span>, <span style="color:#fff;font-weight:bold">sizeof</span>(ListNode));
    check_mem(node);

    node-&gt;value = value;

    <span style="color:#fff;font-weight:bold">if</span>(list-&gt;first == <span style="color:#fff;font-weight:bold">NULL</span>) {
        list-&gt;first = node;
        list-&gt;last = node;
    } <span style="color:#fff;font-weight:bold">else</span> {
        node-&gt;next = list-&gt;first;
        list-&gt;first-&gt;prev = node;
        list-&gt;first = node;
    }

    list-&gt;count++;

error:
    <span style="color:#fff;font-weight:bold">return</span>;
}

<span style="color:#fff;font-weight:bold">void</span> *List_shift(List *list)
{
    ListNode *node = list-&gt;first;
    <span style="color:#fff;font-weight:bold">return</span> node != <span style="color:#fff;font-weight:bold">NULL</span> ? List_remove(list, node) : <span style="color:#fff;font-weight:bold">NULL</span>;
}

<span style="color:#fff;font-weight:bold">void</span> *List_remove(List *list, ListNode *node)
{
    <span style="color:#fff;font-weight:bold">void</span> *result = <span style="color:#fff;font-weight:bold">NULL</span>;

    check(list-&gt;first &amp;&amp; list-&gt;last, <span style="color:#0ff;font-weight:bold">&#34;List is empty.&#34;</span>);
    check(node, <span style="color:#0ff;font-weight:bold">&#34;node can&#39;t be NULL&#34;</span>);

    <span style="color:#fff;font-weight:bold">if</span>(node == list-&gt;first &amp;&amp; node == list-&gt;last) {
        list-&gt;first = <span style="color:#fff;font-weight:bold">NULL</span>;
        list-&gt;last = <span style="color:#fff;font-weight:bold">NULL</span>;
    } <span style="color:#fff;font-weight:bold">else</span> <span style="color:#fff;font-weight:bold">if</span>(node == list-&gt;first) {
        list-&gt;first = node-&gt;next;
        check(list-&gt;first != <span style="color:#fff;font-weight:bold">NULL</span>, <span style="color:#0ff;font-weight:bold">&#34;Invalid list, somehow got a first that is NULL.&#34;</span>);
        list-&gt;first-&gt;prev = <span style="color:#fff;font-weight:bold">NULL</span>;
    } <span style="color:#fff;font-weight:bold">else</span> <span style="color:#fff;font-weight:bold">if</span> (node == list-&gt;last) {
        list-&gt;last = node-&gt;prev;
        check(list-&gt;last != <span style="color:#fff;font-weight:bold">NULL</span>, <span style="color:#0ff;font-weight:bold">&#34;Invalid list, somehow got a next that is NULL.&#34;</span>);
        list-&gt;last-&gt;next = <span style="color:#fff;font-weight:bold">NULL</span>;
    } <span style="color:#fff;font-weight:bold">else</span> {
        ListNode *after = node-&gt;next;
        ListNode *before = node-&gt;prev;
        after-&gt;prev = before;
        before-&gt;next = after;
    }

    list-&gt;count--;
    result = node-&gt;value;
    free(node);

error:
    <span style="color:#fff;font-weight:bold">return</span> result;
}
</code></pre></div><p>现在我们终于实现了双向链表上的所有操作。闹麻了，书上的实现方法感觉跟喂了 Poops 一样。</p>
<ol>
<li>研究双向和单向链表，以及什么情况下其中一种优于另一种。</li>
</ol>
<p>单向链表内存小，性能好；双向链表功能强，比如逆序遍历。</p>
<ol start="2">
<li>研究双向链表的限制。例如，虽然它们对于插入和删除元素很高效，但是对于变量元素比较慢。</li>
</ol>
<p>双向链表更改一个节点意味着要修改两端的节点，这太地狱了。</p>

                    
                    <HR width="100%" id="EOF">
		    <p style="color:#777;">上次修改於 2024-01-23</p>
                    
                </div>
            </div>
            
            
            <nav class="post-pagination">

                
                <a class="newer-posts" href="/posts/ysyx/arch-book/arch-book-1/">
			下回<br>数电与计算机体系结构 01：入门
                </a>
                
                
                
                <a class="older-posts" href="/posts/fsharp-for-csharp-devs/">
			上回<br>写给 C# 开发者的 F# 光速入门教程
                </a>
                
            </nav>
            <div class="post-comment-wrapper">
                












<script src="https://giscus.app/client.js"
        data-repo="Kyocius/kyocius.github.io"
        data-repo-id="MDEwOlJlcG9zaXRvcnkyODE4MDgxOTA="
        data-category="Announcements"
        data-category-id="DIC_kwDOEMwNPs4CXHLA"
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="preferred_color_scheme"
        data-lang="en"
        crossorigin="anonymous"
        async>
</script>

            </div>
        </div>
    </div>


                    </div>
            </div><div id="sideContainer" class="side-container">
    
    <a class="a-block nav-head false" href="https://kyocius.github.io/">
    
        <div class="nav-title">
            游尔曼斯克
        </div>
        
        <div class="nav-subtitle">
            Kyocius &#43;
        </div>
        
    </a>

    <div class="nav-link-list">
        
        
            
            
            
                
            
            
            
            <a class="a-block nav-link-item active" href="/posts">
                歸檔 Archive
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/categories">
                分類 Categories
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/tags">
                標簽 Tags
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/about/">
                關於 About
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/index.xml">
                訂閱 RSS
            </a>
            
        
    </div>

    

    <div class="nav-footer">
        
Hugo Theme <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a> by <a href="https://risehere.net/">Rise</a>
<br>
移植自 <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>

&copy;
	
	Kyocius. 本站遵循 CC-BY-NC 4.0 协议
	

    </div>
    
</div><div id="extraContainer" class="extra-container">
    <div class="toc-wrapper">
        

        
        <div class="toc">


	<div class="toc-content">
	
		
		
		
		<center>- 目錄 -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e5%89%8d%e8%a8%80" class="nav-前言">
									前言
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e7%bb%83%e4%b9%a010%e5%ad%97%e7%ac%a6%e4%b8%b2%e6%95%b0%e7%bb%84%e5%92%8c%e5%be%aa%e7%8e%af" class="nav-练习10字符串数组和循环">
									练习10：字符串数组和循环
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e7%bb%83%e4%b9%a016%e7%bb%93%e6%9e%84%e4%bd%93%e5%92%8c%e6%8c%87%e5%90%91%e5%ae%83%e4%bb%ac%e7%9a%84%e6%8c%87%e9%92%88" class="nav-练习16结构体和指向它们的指针">
									练习16：结构体和指向它们的指针
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e7%bb%83%e4%b9%a017%e5%a0%86%e5%92%8c%e6%a0%88%e7%9a%84%e5%86%85%e5%ad%98%e5%88%86%e9%85%8d" class="nav-练习17堆和栈的内存分配">
									练习17：堆和栈的内存分配
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e7%bb%83%e4%b9%a018%e5%87%bd%e6%95%b0%e6%8c%87%e9%92%88" class="nav-练习18函数指针">
									练习18：函数指针
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e7%bb%83%e4%b9%a032%e5%8f%8c%e5%90%91%e9%93%be%e8%a1%a8" class="nav-练习32双向链表">
									练习32：双向链表
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
        
    </div>
    <div class="pagination">
        <a id="globalBackToTop" class="pagination-action animated-visibility" href="#top"
            :class="{ invisible: scrollY == 0 }">
            <i class="material-icons pagination-action-icon">
                keyboard_arrow_up
            </i>
        </a>
        
        <a type="button" class="pagination-action" id="darkModeToggleButton">
            <span class="material-icons pagination-action-icon" id="darkModeToggleIcon">
                dark_mode
            </span>
        </a>
        
        
    </div>
</div><div id="single-column-footer">
Hugo Theme <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a> by <a href="https://risehere.net/">Rise</a>
<br>
移植自 <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>

&copy;
	
	Kyocius. 本站遵循 CC-BY-NC 4.0 协议
	
</div>
            </div>
    
    <script src="/js/journal.js"></script></body>
</html>
